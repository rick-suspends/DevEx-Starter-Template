# .github/workflows/publish-site.yml
name: Build and Deploy Documentation

on:
  push:
    branches:
      - main # Trigger when new source code is pushed to main
  workflow_dispatch: # Allows manual triggering from the GitHub UI

jobs:
  build_deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: write # Needed for the deployment action
      pull-requests: write # For htmlproofer potentially, though primarily for job failure status

    steps:
      - name: 1. Checkout repository
        uses: actions/checkout@v4
        # Note: No 'ref' needed here, as it defaults to the branch that triggered the workflow (main).

      # --- SETUP STEPS ---

      - name: 2. Setup Ruby
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: '3.3' # Specific Ruby version required by the action

      - name: 2.1 Install Jekyll Gem
        run: |
          echo "Installing Jekyll gem..."
          gem install jekyll
          # Uncomment the line below if your Jekyll site uses specific github-pages plugins/themes
          # echo "Installing github-pages gem..."
          # gem install github-pages
          echo "Jekyll gem installation complete."

      - name: 3. Install System Dependencies (for wkhtmltopdf, etc.)
        run: |
          echo "Updating apt packages and installing system dependencies..."
          sudo apt update
          # Install core wkhtmltopdf dependencies, XVFB, and python3 for the local HTTP server
          sudo apt install -y fontconfig libfreetype6 libx11-6 libxext6 libxrender1 xfonts-base xfonts-75dpi xvfb python3-minimal
          echo "Core dependencies installed."

          # --- Robust wkhtmltopdf installation for Ubuntu 22.04+ (handling libssl1.1) ---
