# .github/workflows/documentation-quality-gate.yml
name: Documentation Quality Gate (HTMLProofer)
# ... (rest of the workflow YAML unchanged) ...

    steps:
      - name: Checkout Deployed Site into 'DevEx-Starter-Template' Subdirectory
        uses: actions/checkout@v4
        with:
          ref: output
          path: DevEx-Starter-Template # Clones the 'output' branch into this folder

      - name: ðŸ’£ Pre-Process HTML: Strip Jekyll Base URL Prefix ðŸ’£
        # This step manually rewrites the files to fix the absolute vs. relative path conflict.
        # It changes "/DevEx-Starter-Template/assets/..." to "/assets/..." across all HTML files.
        run: |
          echo "Rewriting absolute paths in HTML files to remove Jekyll baseurl..."
          find ./DevEx-Starter-Template -type f -name "*.html" -print0 | xargs -0 \
            sed -i 's/\/DevEx-Starter-Template\//\//g'
          echo "Path rewrite complete. Checking sample..."
          # Verify the rewrite on index.html
          grep 'DevEx-Starter-Template/assets' ./DevEx-Starter-Template/index.html && \
            echo "ERROR: Prefix was NOT stripped (sed failed)." || \
            echo "SUCCESS: Prefix stripped from sample file. Proceeding to htmlproofer."
          
      - name: âš™ï¸ Run HTMLProofer on Top-Level Deployed Docs
        uses: chabad360/htmlproofer@v1
        with:
          # Now, the HTML content contains: "/assets/images/md.png"
          # This will resolve correctly against the 'directory' path.
          directory: ./DevEx-Starter-Template 
          args: >-
            --url-ignore "#.*"
            --url-ignore "/cdn-cgi/#.*"
            --allow-hash-href
            --disable-external
            --file-ignore "/pdfs/assembled.pdf"
            --report-missing-names
            --check-html
            --check-favicon
            # --- NO SWAP_URLS NEEDED! --- The files are already fixed.
