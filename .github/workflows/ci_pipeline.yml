name: Docs CI/Quality Assurance

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build_and_test_docs:
    runs-on: ubuntu-latest

    steps:
      # 1. CHECKOUT CODE 
      - name: Checkout Repository
        uses: actions/checkout@v4

      # 2. PYTHON SETUP (Assuming you need Python for your CLI/FastAPI tests)
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: Install Python Dependencies (e.g., Typer, FastAPI)
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          # Run Python unit tests here
          # pytest ./src/

      # 3. RUBY/JEKYLL SETUP & BUILD
      - name: Set up Ruby environment
        uses: ruby/setup-ruby@v1
        with:
          # Use a stable Ruby version
          ruby-version: '3.2'
          # Installs dependencies from Gemfile.lock (preferred for speed/consistency)
          bundler-cache: true

      - name: Build Jekyll Site
        # The site must be built before htmlproofer can check the output
        run: bundle exec jekyll build --config docs/_config.yml --destination ./_site/docs

      # 4. HTML PROOFING (QUALITY ASSURANCE)
      - name: Run HTMLProofer for Link and HTML Validation
        run: |
          # The command runs against the final built site files in the destination directory
          bundle exec htmlproofer ./_site/docs \
            --url-ignore "/#/" \
            --check-html \
            --allow-hash-href \
            --disable-external 
            # '--disable-external' is crucial for fast runs; remove it to check external links (slower)
        env:
          # Increase timeout if you decide to check external links later
          HTMLPROOFER_TIMEOUT: 60 

      # 5. DEPLOYMENT (Only runs if steps above succeed)
      # This step would deploy the contents of ./_site/docs to GitHub Pages
      # Omitted here for brevity, but this is where your deployment action goes.
